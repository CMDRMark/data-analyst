# Тестовое задание для Junior Data Analyst

## Описание проекта
Компания электронной коммерции продает 3 типа продуктов (3 уровня стоимости, по 1 продукту каждого уровня). Компания предоставляет варианты оплаты и скидки (5%, 10%, 15%, 20%).

## Задача 1: Создание базы данных

### Требования:
1. Создать **один Python файл** (например, `create_database.py`), в котором:
   - Импортировать модуль `sqlite3`
   - Подключиться к существующему файлу базы данных `ecommerce.db`
   - Создать 3 таблицы: products, users, transactions

2. Запустить тесты для проверки корректности создания БД

### Схема таблиц:

#### Таблица Products:
- `product_id` (INTEGER PRIMARY KEY) - ID продукта
- `name` (TEXT NOT NULL) - название продукта
- `production_cost` (REAL NOT NULL) - себестоимость производства
- `retail_cost` (REAL NOT NULL) - розничная цена
- `tier` (INTEGER NOT NULL) - уровень продукта (1, 2, или 3)

#### Таблица Users:
- `user_id` (INTEGER PRIMARY KEY) - ID пользователя
- `name` (TEXT NOT NULL) - имя пользователя
- `age` (INTEGER NOT NULL) - возраст
- `geo` (TEXT NOT NULL) - географический регион
- `discount_tier` (INTEGER NOT NULL) - уровень скидки (0, 5, 10, 15, 20)

#### Таблица Transactions:
- `transaction_id` (INTEGER PRIMARY KEY) - ID транзакции
- `product_id` (INTEGER NOT NULL) - ID продукта (внешний ключ)
- `user_id` (INTEGER NOT NULL) - ID пользователя (внешний ключ)
- `transaction_date` (DATE NOT NULL) - дата транзакции
- `initial_cost` (REAL NOT NULL) - начальная стоимость
- `applied_discount` (REAL NOT NULL) - примененная скидка
- `final_cost` (REAL NOT NULL) - итоговая стоимость

### Пример структуры файла create_database.py:
```python
import sqlite3

# Подключение к базе данных
conn = sqlite3.connect('ecommerce.db')
cursor = conn.cursor()

# Создание таблиц
# ... ваш код здесь ...

conn.commit()
conn.close()
```

### Тестирование создания БД:
После создания базы данных запустить тесты:
```bash
python tests/test_database.py
```

Тесты проверят:
- Существование всех таблиц
- Корректность схемы таблиц (названия и типы колонок)
- Настройку внешних ключей

## Задача 2: Генерация данных

После успешного прохождения тестов БД, запустить скрипт генерации данных:
```bash
python main.py
```

Скрипт создаст:
- 3 продукта (по одному для каждого уровня)
- 50 пользователей (распределенных по 7 географическим регионам)
- 1000 транзакций за последние 6 месяцев

## Задача 3: Анализ данных

Провести анализ данных в базе для выявления:
1. Эффективности скидок на общую выручку
2. Популярности продуктов (общей и по географическим регионам)
3. Прибыльности различных уровней скидок для компании

### Ожидаемые результаты анализа:
- Скидки увеличивают общие покупки (больше денег для компании)
- Возможность определить самые популярные продукты
- Анализ популярности продуктов по географическим регионам
- Определение наиболее прибыльного уровня скидок

## Полезные команды

### Сброс базы данных:
```bash
# Очистить таблицы и пересоздать их
python clean_db.py

# Полная очистка (удаление файла БД)
python clean_db.py --reset

# Очистить БД перед запуском main.py
python main.py --clean
```

### Проверка базы данных:
```bash
# Запустить тесты для проверки корректности БД
python tests/test_database.py

# Только тестирование БД (без генерации данных)
python main.py --test-only
```

### Что проверяют тесты:
1. **Существование таблиц** - проверяет, что созданы все 3 таблицы: products, users, transactions
2. **Схема таблиц** - проверяет правильность названий и количества колонок
3. **Типы данных** - проверяет корректность типов данных для каждой колонки
4. **Внешние ключи** - проверяет настройку связей между таблицами

### Если тесты не проходят:
- Проверьте, что файл `ecommerce.db` существует
- Убедитесь, что все таблицы созданы с правильными названиями
- Проверьте, что колонки имеют правильные типы данных
- Убедитесь, что внешние ключи настроены корректно

## Технические требования:
- Python 3.7+
- SQLite
- pandas
- Знание SQL, списков, словарей Python

## Структура проекта:
```
project/
├── requirements_ru.md          # Данный файл с требованиями
├── main.py                     # Основной скрипт для создания БД и генерации данных
├── clean_db.py                 # Скрипт для очистки базы данных
├── analysis.py                 # Примеры анализа
├── ecommerce.db                # Файл базы данных (создается автоматически)
├── setup/
│   ├── database.py            # Схема базы данных
│   └── data_generators.py     # Генератор данных
└── tests/
    └── test_database.py       # Тесты для проверки БД
```

## Порядок выполнения:
1. Изучить требования и схему таблиц
2. Создать файл `create_database.py` с кодом для создания БД и таблиц
3. Запустить тесты: `python tests/test_database.py`
4. После успешного прохождения тестов запустить: `python main.py`
5. Провести анализ данных: `python analysis.py`

## Устранение неполадок:
- **Если нужно начать заново**: `python clean_db.py --reset`
- **Если только проверить БД**: `python main.py --test-only`
- **Если очистить и пересоздать**: `python main.py --clean`
- **Если тесты не проходят**: проверьте схему таблиц и типы данных
