# Тестовое задание для Junior Data Analyst

## Описание проекта
Компания электронной коммерции продает 3 типа продуктов (3 уровня стоимости, по 1 продукту каждого уровня). Компания предоставляет варианты оплаты и скидки (5%, 10%, 15%, 20%).

## Задача 1: Создание базы данных

### Требования:
1. Создать **один Python файл** (например, `create_database.py`), в котором:
   - Импортировать модуль `sqlite3`
   - Подключиться к существующему файлу базы данных `ecommerce.db`
   - Создать 3 таблицы: products, users, transactions

### Схема таблиц:

#### Таблица Products:
- `product_id` (INTEGER PRIMARY KEY) - ID продукта
- `name` (TEXT NOT NULL) - название продукта
- `production_cost` (REAL NOT NULL) - себестоимость производства
- `retail_cost` (REAL NOT NULL) - розничная цена
- `tier` (INTEGER NOT NULL) - уровень продукта (1, 2, или 3)

#### Таблица Users:
- `user_id` (INTEGER PRIMARY KEY) - ID пользователя
- `name` (TEXT NOT NULL) - имя пользователя
- `age` (INTEGER NOT NULL) - возраст
- `geo` (TEXT NOT NULL) - географический регион
- `discount_tier` (INTEGER NOT NULL) - уровень скидки (0, 5, 10, 15, 20)

#### Таблица Transactions:
- `transaction_id` (INTEGER PRIMARY KEY) - ID транзакции
- `product_id` (INTEGER NOT NULL) - ID продукта (внешний ключ)
- `user_id` (INTEGER NOT NULL) - ID пользователя (внешний ключ)
- `transaction_date` (DATE NOT NULL) - дата транзакции
- `initial_cost` (REAL NOT NULL) - начальная стоимость
- `applied_discount` (REAL NOT NULL) - примененная скидка
- `final_cost` (REAL NOT NULL) - итоговая стоимость

### Пример структуры файла create_database.py:
```python
import sqlite3

# Подключение к базе данных
conn = sqlite3.connect('ecommerce.db')
cursor = conn.cursor()

# Создание таблиц
# ... ваш код здесь ...

conn.commit()
conn.close()
```

2. Запустить тесты для проверки корректности создания БД
### Тестирование создания БД:
После создания базы данных запустить тесты:
```bash
python tests/test_database.py
```

Тесты проверят:
- Существование всех таблиц
- Корректность схемы таблиц (названия и типы колонок)
- Настройку внешних ключей

## Задача 2: Генерация данных

После успешного прохождения тестов БД, запустить скрипт генерации данных:
```bash
python setup/data_generators.py
```

Скрипт создаст:
- 3 продукта (по одному для каждого уровня)
- 50 пользователей (распределенных по 7 географическим регионам)
- 1000 транзакций за последние 6 месяцев

## Задача 3: Анализ данных и подготовка отчета

### Цель анализа:
Провести комплексный анализ эффективности скидочной политики компании и подготовить отчет для руководства с конкретными рекомендациями.

### Конкретные задачи анализа:

#### 3.1 Анализ эффективности скидок
**Вопросы для анализа:**
- Как скидки влияют на общую выручку компании?
- Какие уровни скидок приносят больше денег?
- Есть ли разница в эффективности скидок для разных продуктов?

**Что нужно рассчитать:**
- Общую выручку по категориям скидок (без скидки, низкая 5-10%, высокая 15-20%)
- Средний чек по каждой категории скидок
- Количество транзакций по каждой категории скидок

**Подсказки по pandas:**
- Используйте `pd.cut()` или `pd.qcut()` для создания категорий скидок
- `groupby()` + `agg()` для группировки по категориям скидок
- `count()`, `sum()`, `mean()` для подсчета метрик

#### 3.2 Анализ популярности продуктов
**Вопросы для анализа:**
- Какие продукты продаются лучше всего?
- Есть ли разница в популярности продуктов по географическим регионам?
- Как скидки влияют на продажи разных продуктов?

**Что нужно рассчитать:**
- Топ-3 самых популярных продукта по количеству продаж
- Популярность продуктов по регионам
- Среднюю скидку для каждого продукта

**Подсказки по pandas:**
- `merge()` для объединения таблиц products и transactions
- `groupby('product_id')` для группировки по продуктам
- `sort_values()` для сортировки по популярности
- `head(3)` для получения топ-3

#### 3.3 Географический анализ
**Вопросы для анализа:**
- В каких регионах компания работает лучше всего?
- Есть ли региональные особенности в использовании скидок?
- Какие регионы наиболее прибыльны?

**Что нужно рассчитать:**
- Выручку по каждому региону
- Средний размер скидки по регионам
- Количество транзакций по регионам

**Подсказки по pandas:**
- `merge()` для объединения users и transactions
- `groupby('geo')` для группировки по регионам
- `nunique()` для подсчета уникальных пользователей по регионам

#### 3.4 Анализ прибыльности скидочных уровней
**Вопросы для анализа:**
- Какие уровни скидок наиболее прибыльны для компании?
- Как скидки влияют на поведение пользователей?
- Стоит ли расширять скидочную программу?

**Что нужно рассчитать:**
- Прибыльность каждого уровня скидок
- Поведение пользователей с разными уровнями скидок
- Рекомендации по оптимизации скидочной политики

**Подсказки по pandas:**
- `groupby('discount_tier')` для анализа по уровням скидок
- `describe()` для получения статистик по группам
- Создание новых колонок с помощью `apply()` или арифметических операций

### Требования к отчету:

#### Структура отчета:
1. **Краткое резюме** (2-3 предложения о главных выводах)
2. **Методология** (какие данные анализировались, какие метрики использовались)
3. **Основные результаты** (конкретные цифры и факты)
4. **Выводы и рекомендации** (что делать дальше)

#### Что должно быть в отчете:
- **Таблицы с ключевыми метриками** (используйте pandas для красивого форматирования)
- **Графики** (если умеете работать с matplotlib/seaborn)
- **Конкретные цифры** (не "много", а "на 23% больше")
- **Практические рекомендации** (что изменить в бизнесе)

#### Примеры рекомендаций:
- "Увеличить скидки на продукты Tier 2, так как они показывают рост продаж на 45% при скидке 15%"
- "Сфокусироваться на регионе USA - там самая высокая конверсия со скидками"
- "Продукт 'Premium Headphones' требует пересмотра ценовой политики"

### Подсказки по выполнению:

#### Работа с данными:
**Импорт и подключение:**
- `pd.read_sql_query()` для чтения данных из SQLite
- `sqlite3.connect()` для подключения к базе

**Основные операции pandas:**
- `df.head()` - посмотреть первые строки
- `df.info()` - информация о структуре данных
- `df.describe()` - статистическое описание числовых колонок
- `df.columns` - названия колонок
- `df.shape` - размер таблицы (строки, колонки)

**Группировка и агрегация:**
- `df.groupby('колонка')['колонка'].agg(['sum', 'count', 'mean'])`
- `df.groupby(['колонка1', 'колонка2']).size()` для подсчета по нескольким группам

**Фильтрация данных:**
- `df[df['колонка'] > значение]` - фильтр по условию
- `df.query('колонка > значение')` - альтернативный способ фильтрации
- `df.loc[условие]` - фильтрация по индексу

**Сортировка:**
- `df.sort_values('колонка', ascending=False)` - сортировка по убыванию
- `df.nlargest(5, 'колонка')` - топ-5 по значению колонки

**Создание новых колонок:**
- `df['новая_колонка'] = df['колонка1'] + df['колонка2']`
- `df['категория'] = df['колонка'].apply(функция)`

#### Визуализация (опционально):
**Базовые графики:**
- `df.plot(kind='bar')` - столбчатая диаграмма
- `df.plot(kind='line')` - линейный график
- `df.plot(kind='pie')` - круговая диаграмма

**Настройка графиков:**
- `plt.figure(figsize=(10, 6))` - размер графика
- `plt.title('Заголовок')` - заголовок
- `plt.xlabel('Ось X')` - подпись оси X
- `plt.ylabel('Ось Y')` - подпись оси Y

### Критерии оценки:
- **Качество анализа** (глубина понимания данных)
- **Практичность рекомендаций** (можно ли применить в бизнесе)
- **Презентация результатов** (четкость и структурированность)
- **Техническое исполнение** (правильность SQL-запросов, использование pandas)

## Полезные команды

### Сброс базы данных:
```bash
# Очистить таблицы и пересоздать их
python clean_db.py
```

### Что проверяют тесты:
1. **Существование таблиц** - проверяет, что созданы все 3 таблицы: products, users, transactions
2. **Схема таблиц** - проверяет правильность названий и количества колонок
3. **Типы данных** - проверяет корректность типов данных для каждой колонки
4. **Внешние ключи** - проверяет настройку связей между таблицами

### Если тесты не проходят:
- Проверьте, что файл `ecommerce.db` существует
- Убедитесь, что все таблицы созданы с правильными названиями
- Проверьте, что колонки имеют правильные типы данных
- Убедитесь, что внешние ключи настроены корректно

## Технические требования:
- Python 3.7+
- SQLite
- pandas
- Знание SQL, списков, словарей Python
- Базовые навыки анализа данных

## Структура проекта:
```
project/
├── requirements_ru.md          # Данный файл с требованиями
├── clean_db.py                 # Скрипт для очистки базы данных
├── ecommerce.db                # Файл базы данных (создается автоматически)
├── setup/
│   ├── database.py            # Схема базы данных
│   └── data_generators.py     # Генератор данных
└── tests/
    └── test_database.py       # Тесты для проверки БД
```

## Порядок выполнения:
1. Изучить требования и схему таблиц
2. Создать файл `create_database.py` с кодом для создания БД и таблиц
3. Запустить тесты: `python tests/test_database.py`
4. После успешного прохождения тестов запустить: `python setup/data_generators.py`
5. Провести анализ данных и подготовить отчет согласно требованиям Задачи 3

## Устранение неполадок:
- **Если нужно начать заново**: `python clean_db.py`
- **Если только проверить БД**: `python tests/test_database.py`
- **Если нужны подсказки по pandas**: изучите раздел "Подсказки по выполнению"
- **Если не получается группировка**: начните с простых `groupby()` операций
- **Если нужна помощь с SQL**: используйте `pd.read_sql_query()` для выполнения запросов
